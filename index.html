<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Directorio Escuelas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="icon" href="./img/Icon.png" type="image/png">
</head>

<body class="body">
    <aside class="sidebar">
        <img src="./img/Logo.png" class="logo" alt="Logo Directorio Escuelas" />
        <h1>ESCUELAS PÚBLICAS - LOMAS DE ZAMORA</h1>
        <div class="search">
            <button id="btnLogin" class="btn-login">INICIAR SESIÓN</button>
            <button id="btnCuenta" class="btn-login" style="display:none">IR A MI CUENTA</button>
        </div>
        <div class="search">
            <input class="nivel" id="q" placeholder="Buscar por nombre, barrio o dirección">
            <select class="nivel" id="filtroNivel">
                <option value="">Todos los niveles</option>
                <option value="Inicial">Inicial</option>
                <option value="Primaria">Primaria</option>
                <option value="Primaria Adultos">Primaria de Adultos</option>
                <option value="Secundaria">Secundaria</option>
                <option value="Secundaria Adultos">Secundaria de Adultos</option>
                <option value="Técnica">Técnica</option>
                <option value="Especial">Especial</option>
                <option value="Centro Profesional">Centro de Formación Profesional</option>
                <option value="Educación Superior">Educación Superior</option>
                <option value="Centros Complementarios">Centros Complementarios</option>
                <option value="Otros">Otros</option>
            </select>
        </div>
        <button id="btnBuscar" class="btn-login">BUSCAR</button>
        <div class="school-list" id="lista"></div>
    </aside>

    <main class="map" id="map"></main>

    <script type="module" src="./js/appIndex.js"></script>
    <script>
        document.getElementById('btnLogin').addEventListener('click', () => {
            window.location.href = 'login.html';
        });
    </script>
     <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { firebaseConfig } from './js/firebaseConfig.js';
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } 
            from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
    
        async function incrementarVisitas() {
            try {
                console.log("Intentando incrementar visitas...");
                const visitasRef = doc(db, "estadisticas", "visitas");
                const visitasSnap = await getDoc(visitasRef);

                if (!visitasSnap.exists()) {
                    console.log("Documento 'visitas' no existe. Creando con cantidad=1.");
                    await setDoc(visitasRef, { cantidad: 1 });
                    console.log("Documento creado.");
                } else {
                    console.log("Documento existe con cantidad actual:", visitasSnap.data().cantidad);
                    await updateDoc(visitasRef, { cantidad: increment(1) });
                    console.log("Cantidad incrementada.");
                }
            } catch (error) {
                console.error("Error incrementando visitas:", error);
            }
        }

        incrementarVisitas();
    </script>
</body>

</html>